!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@azure/msal-browser"),require("rxjs"),require("@angular/router"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@azure/msal-angular",["exports","@angular/core","@angular/common","@azure/msal-browser","rxjs","@angular/router","rxjs/operators"],t):t(((e=e||self).azure=e.azure||{},e.azure["msal-angular"]={}),e.ng.core,e.ng.common,e["@azure/msal-browser"],e.rxjs,e.ng.router,e.rxjs.operators)}(this,(function(e,t,r,n,o,i,a){"use strict";var c=new t.InjectionToken("MSAL_INSTANCE"),s=new t.InjectionToken("MSAL_GUARD_CONFIG"),u=new t.InjectionToken("MSAL_INTERCEPTOR_CONFIG"),g="@azure/msal-angular",p="2.0.0-alpha.6",l=function(){function e(e,t){this.instance=e,this.location=t;var r=this.location.path(!0).split("#").pop();r&&(this.redirectHash="#"+r),this.instance.initializeWrapperLibrary(n.WrapperSKU.Angular,p)}return e.prototype.acquireTokenPopup=function(e){return o.from(this.instance.acquireTokenPopup(e))},e.prototype.acquireTokenRedirect=function(e){return o.from(this.instance.acquireTokenRedirect(e))},e.prototype.acquireTokenSilent=function(e){return o.from(this.instance.acquireTokenSilent(e))},e.prototype.handleRedirectObservable=function(){var e=o.from(this.instance.handleRedirectPromise(this.redirectHash));return this.redirectHash="",e},e.prototype.loginPopup=function(e){return o.from(this.instance.loginPopup(e))},e.prototype.loginRedirect=function(e){return o.from(this.instance.loginRedirect(e))},e.prototype.logout=function(e){return o.from(this.instance.logout(e))},e.prototype.ssoSilent=function(e){return o.from(this.instance.ssoSilent(e))},e.prototype.getLogger=function(){return this.logger||(this.logger=this.instance.getLogger().clone(g,p)),this.logger},e.prototype.setLogger=function(e){this.logger=e.clone(g,p),this.instance.setLogger(e)},e}();l.decorators=[{type:t.Injectable}],l.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[c]}]},{type:r.Location}]};var h=function(){function e(e,t,r,n){this.msalGuardConfig=e,this.authService=t,this.location=r,this.router=n}return e.prototype.parseUrl=function(e){return this.router.parseUrl(e)},e.prototype.getDestinationUrl=function(e){this.authService.getLogger().verbose("Guard - getting destination url");var t=document.getElementsByTagName("base"),r=this.location.normalize(t.length?t[0].href:window.location.origin),n=this.location.prepareExternalUrl(e);return n.startsWith("#")?(this.authService.getLogger().verbose("Guard - destination by hash routing"),r+"/"+n):""+r+e},e.prototype.loginInteractively=function(e){var t=this;if(this.msalGuardConfig.interactionType===n.InteractionType.Popup)return this.authService.getLogger().verbose("Guard - logging in by popup"),this.authService.loginPopup(Object.assign({},this.msalGuardConfig.authRequest)).pipe(a.map((function(e){return t.authService.getLogger().verbose("Guard - login by popup successful, can activate, setting active account"),t.authService.instance.setActiveAccount(e.account),!0})));this.authService.getLogger().verbose("Guard - logging in by redirect");var r=this.getDestinationUrl(e);return this.authService.loginRedirect(Object.assign({redirectStartPage:r},this.msalGuardConfig.authRequest)).pipe(a.map((function(){return!1})))},e.prototype.activateHelper=function(e){var r=this;if(this.msalGuardConfig.interactionType!==n.InteractionType.Popup&&this.msalGuardConfig.interactionType!==n.InteractionType.Redirect)throw new n.BrowserConfigurationAuthError("invalid_interaction_type","Invalid interaction type provided to MSAL Guard. InteractionType.Popup or InteractionType.Redirect must be provided in the MsalGuardConfiguration");return this.authService.getLogger().verbose("MSAL Guard activated"),n.UrlString.hashContainsKnownProperties(window.location.hash)&&n.BrowserUtils.isInIframe()?(this.authService.getLogger().warning("Guard - redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication."),o.of(!1)):(this.msalGuardConfig.loginFailedRoute&&(this.loginFailedRoute=this.parseUrl(this.msalGuardConfig.loginFailedRoute)),this.authService.handleRedirectObservable().pipe(a.concatMap((function(){return r.authService.instance.getAllAccounts().length?(r.authService.getLogger().verbose("Guard - account retrieved, can activate or load"),o.of(!0)):e?(r.authService.getLogger().verbose("Guard - no accounts retrieved, log in required to activate"),r.loginInteractively(e.url)):(r.authService.getLogger().verbose("Guard - no accounts retrieved, no state, cannot load"),o.of(!1))})),a.catchError((function(){return r.authService.getLogger().verbose("Guard - error while logging in, unable to activate"),r.loginFailedRoute&&parseInt(t.VERSION.major,10)>9&&e?(r.authService.getLogger().verbose("Guard - loginFailedRoute set, redirecting"),o.of(r.loginFailedRoute)):o.of(!1)}))))},e.prototype.canActivate=function(e,t){return this.authService.getLogger().verbose("Guard - canActivate"),this.activateHelper(t)},e.prototype.canActivateChild=function(e,t){return this.authService.getLogger().verbose("Guard - canActivateChild"),this.activateHelper(t)},e.prototype.canLoad=function(){return this.authService.getLogger().verbose("Guard - canLoad"),this.activateHelper()},e}();h.decorators=[{type:t.Injectable}],h.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[s]}]},{type:l},{type:r.Location},{type:i.Router}]};var d=function(){function e(e,t){this.msalInterceptorConfig=e,this.authService=t}return e.prototype.intercept=function(e,t){var r=this;if(this.msalInterceptorConfig.interactionType!==n.InteractionType.Popup&&this.msalInterceptorConfig.interactionType!==n.InteractionType.Redirect)throw new n.BrowserConfigurationAuthError("invalid_interaction_type","Invalid interaction type provided to MSAL Interceptor. InteractionType.Popup, InteractionType.Redirect must be provided in the msalInterceptorConfiguration");this.authService.getLogger().verbose("MSAL Interceptor activated");var i,c=this.getScopesForEndpoint(e.url);return this.authService.instance.getActiveAccount()?(this.authService.getLogger().verbose("Interceptor - active account selected"),i=this.authService.instance.getActiveAccount()):(this.authService.getLogger().verbose("Interceptor - no active account, fallback to first account"),i=this.authService.instance.getAllAccounts()[0]),c&&0!==c.length?(this.authService.getLogger().info("Interceptor - "+c.length+" scopes found for endpoint"),this.authService.getLogger().infoPii("Interceptor - ["+c+"] scopes found for "+e.url),this.authService.acquireTokenSilent(Object.assign(Object.assign({},this.msalInterceptorConfig.authRequest),{scopes:c,account:i})).pipe(a.catchError((function(){return r.authService.getLogger().error("Interceptor - acquireTokenSilent rejected with error. Invoking interaction to resolve."),r.acquireTokenInteractively(c)})),a.switchMap((function(e){return e.accessToken?o.of(e):(r.authService.getLogger().error("Interceptor - acquireTokenSilent resolved with null access token. Known issue with B2C tenants, invoking interaction to resolve."),r.acquireTokenInteractively(c))})),a.switchMap((function(n){r.authService.getLogger().verbose("Interceptor - setting authorization headers");var o=e.headers.set("Authorization","Bearer "+n.accessToken),i=e.clone({headers:o});return t.handle(i)})))):(this.authService.getLogger().verbose("Interceptor - no scopes for endpoint"),t.handle(e))},e.prototype.acquireTokenInteractively=function(e){if(this.msalInterceptorConfig.interactionType===n.InteractionType.Popup)return this.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by popup"),this.authService.acquireTokenPopup(Object.assign(Object.assign({},this.msalInterceptorConfig.authRequest),{scopes:e}));this.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by redirect");var t=window.location.href;return this.authService.acquireTokenRedirect(Object.assign(Object.assign({},this.msalInterceptorConfig.authRequest),{scopes:e,redirectStartPage:t})),o.EMPTY},e.prototype.getScopesForEndpoint=function(e){this.authService.getLogger().verbose("Interceptor - getting scopes for endpoint");var t=Array.from(this.msalInterceptorConfig.protectedResourceMap.keys()).filter((function(t){return n.StringUtils.matchPattern(t,e)}));if(t.length>0){var r=t[0];if(r)return this.msalInterceptorConfig.protectedResourceMap.get(r)}return null},e}();d.decorators=[{type:t.Injectable}],d.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[u]}]},{type:l}]};var v=function(e){var t=this;this.msalInstance=e,this._msalSubject=new o.Subject,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new o.Subject,this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback((function(e){t._msalSubject.next(e);var r=n.EventMessageUtils.getInteractionStatusFromEvent(e);null!==r&&(t.msalInstance.getLogger().verbose("BroadcastService - "+e.eventType+" results in setting inProgress to "+r),t._inProgress.next(r))}))};v.decorators=[{type:t.Injectable}],v.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[c]}]}]};var f=function(){function e(){}return e.forRoot=function(t,r,n){return{ngModule:e,providers:[{provide:c,useValue:t},{provide:s,useValue:r},{provide:u,useValue:n},l]}},e}();f.decorators=[{type:t.NgModule,args:[{declarations:[],imports:[r.CommonModule],providers:[h,v]}]}];var y=function(){function e(e){this.authService=e}return e.prototype.ngOnInit=function(){this.authService.handleRedirectObservable().subscribe()},e}();y.decorators=[{type:t.Component,args:[{selector:"app-redirect",template:""}]}],y.ctorParameters=function(){return[{type:l}]},e.MSAL_GUARD_CONFIG=s,e.MSAL_INSTANCE=c,e.MSAL_INTERCEPTOR_CONFIG=u,e.MsalBroadcastService=v,e.MsalGuard=h,e.MsalInterceptor=d,e.MsalModule=f,e.MsalRedirectComponent=y,e.MsalService=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=azure-msal-angular.umd.min.js.map